# ECH Workers Proxy for OpenWrt

åŸºäº ECH (Encrypted Client Hello) æŠ€æœ¯çš„ä»£ç†å®¢æˆ·ç«¯ï¼Œä¸“ä¸º OpenWrt è·¯ç”±å™¨è®¾è®¡ï¼Œå¸¦æœ‰ LuCI ç®¡ç†ç•Œé¢ã€‚

Telegram äº¤æµç¾¤ï¼šhttps://t.me/+ft-zI76oovgwNmRh

## åŠŸèƒ½ç‰¹æ€§

- âœ… **ä¸€é”®å®‰è£…** - å•ä¸ª IPK åŒ…åŒ…å«ä¸»ç¨‹åºå’Œ LuCI ç•Œé¢
- âœ… **LuCI ç®¡ç†ç•Œé¢** - å›¾å½¢åŒ–é…ç½®ï¼Œæ— éœ€å‘½ä»¤è¡Œ
- âœ… **å¤šæœåŠ¡å™¨ç®¡ç†** - æ”¯æŒæ·»åŠ å¤šä¸ªæœåŠ¡å™¨é…ç½®ï¼Œå¿«é€Ÿåˆ‡æ¢
- âœ… **åˆ†æµè®¾ç½®** - å…¨å±€ä»£ç† / è·³è¿‡ä¸­å›½å¤§é™† / ä»…ä»£ç†è¢«å¢™ç«™ç‚¹
- âœ… **å®æ—¶æ—¥å¿—** - æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œä¸€é”®æ¸…ç©º
- âœ… **å¼€æœºè‡ªå¯** - æ”¯æŒç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
- âœ… **ECH åŠ å¯†** - åŠ å¯† TLS æ¡æ‰‹ä¸­çš„ SNIï¼Œä¿æŠ¤éšç§

## å¿«é€Ÿå®‰è£…æ•™ç¨‹

### ç¬¬ä¸€æ­¥ï¼šä¸‹è½½ IPK åŒ…

ä» [GitHub Releases](https://github.com/zhengwuji/ech-op/releases) ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼š

- **x86_64 æ¶æ„**ï¼š`ech-wk_1.0.0-r1_x86_64.ipk`

> ğŸ’¡ åªéœ€ä¸‹è½½è¿™ä¸€ä¸ªæ–‡ä»¶ï¼Œå·²åŒ…å«ä¸»ç¨‹åºå’Œ LuCI ç•Œé¢ï¼

### ç¬¬äºŒæ­¥ï¼šå®‰è£… IPK åŒ…

**æ–¹æ³•ä¸€ï¼šé€šè¿‡ LuCI ç•Œé¢å®‰è£…ï¼ˆæ¨èï¼‰**

1. ç™»å½• OpenWrt ç®¡ç†ç•Œé¢
2. è¿›å…¥ **ç³»ç»Ÿ â†’ è½¯ä»¶åŒ…**
3. ç‚¹å‡» **ä¸Šä¼ è½¯ä»¶åŒ…**ï¼Œé€‰æ‹©ä¸‹è½½çš„ IPK æ–‡ä»¶
4. ç‚¹å‡» **å®‰è£…**

**æ–¹æ³•äºŒï¼šé€šè¿‡ SSH å‘½ä»¤å®‰è£…**

```bash
# ä¸Šä¼  IPK åˆ°è·¯ç”±å™¨
scp ech-wk_1.0.0-r1_x86_64.ipk root@192.168.1.1:/tmp/

# SSH ç™»å½•è·¯ç”±å™¨
ssh root@192.168.1.1

# å®‰è£…
opkg install /tmp/ech-wk_1.0.0-r1_x86_64.ipk
```

### ç¬¬ä¸‰æ­¥ï¼šæ¸…é™¤ LuCI ç¼“å­˜

```bash
rm -rf /tmp/luci-*
```

ç„¶ååˆ·æ–°æµè§ˆå™¨é¡µé¢ã€‚

### ç¬¬å››æ­¥ï¼šé…ç½®æœåŠ¡

1. è¿›å…¥ **æœåŠ¡ â†’ ECH Workers Proxy**
2. åœ¨ã€ŒæœåŠ¡å™¨ç®¡ç†ã€ä¸­æ·»åŠ æœåŠ¡å™¨ï¼š
   - **æœåŠ¡å™¨åç§°**ï¼šè‡ªå®šä¹‰åç§°
   - **æœåŠ¡åœ°å€**ï¼š`your-worker.workers.dev:443`
   - **èº«ä»½ä»¤ç‰Œ**ï¼šæ‚¨çš„ Tokenï¼ˆå¯é€‰ï¼‰
   - å‹¾é€‰ **å½“å‰ä½¿ç”¨**
3. åœ¨ã€Œæ ¸å¿ƒé…ç½®ã€ä¸­è®¾ç½®ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ `127.0.0.1:30000`ï¼‰
4. åœ¨ã€Œåˆ†æµè®¾ç½®ã€ä¸­é€‰æ‹©ä»£ç†æ¨¡å¼
5. åœ¨ã€ŒæœåŠ¡æ§åˆ¶ã€ä¸­å¯ç”¨æœåŠ¡
6. ç‚¹å‡» **ä¿å­˜å¹¶åº”ç”¨**

## LuCI ç•Œé¢åŠŸèƒ½è¯´æ˜

| åŠŸèƒ½æ¨¡å— | è¯´æ˜ |
|---------|------|
| **æœåŠ¡æ§åˆ¶** | è¿è¡ŒçŠ¶æ€æ˜¾ç¤ºã€å¯ç”¨å¼€å…³ã€å¼€æœºè‡ªå¯ |
| **æœåŠ¡å™¨ç®¡ç†** | æ–°å¢/åˆ é™¤æœåŠ¡å™¨ï¼Œé€‰æ‹©å½“å‰ä½¿ç”¨çš„æœåŠ¡å™¨ |
| **æ ¸å¿ƒé…ç½®** | è®¾ç½®ç›‘å¬åœ°å€ |
| **é«˜çº§é€‰é¡¹** | ä¼˜é€‰IP/åŸŸåã€DOHæœåŠ¡å™¨ã€ECHåŸŸå |
| **åˆ†æµè®¾ç½®** | å…¨å±€ä»£ç† / è·³è¿‡ä¸­å›½å¤§é™† / ä»…ä»£ç†è¢«å¢™ç«™ç‚¹ / ç›´è¿ |
| **è¿è¡Œæ—¥å¿—** | å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œä¸€é”®æ¸…ç©º |

## æ„å»ºäº§ç‰©ä¸è®¾å¤‡é€‚é…

GitHub Actions ä¼šä¸ºä¸»æµ OpenWrt è®¾å¤‡ç”Ÿæˆ IPKï¼ˆä¿ç•™åŸæœ‰ x86 æ­£å¸¸æ„å»ºï¼‰ï¼Œä¸‹è½½å¯¹åº”æ¶æ„çš„ IPK å®‰è£…å³å¯ï¼š

- `ech-wk_x86_64.ipk`ï¼šx86/64 é€šç”¨ PCã€å·¥æ§æœºï¼ˆåŸæœ‰æ„å»ºä¿æŒä¸å˜ï¼‰
- `ech-wk-rockchip-armv8.ipk`ï¼šRockchip RK35xx/RK33xx ç³»åˆ—ï¼ˆå¦‚ Radxa ROCKã€NanoPi R5 ç³»åˆ—ã€Hinlink OPC ç­‰ï¼‰
- `ech-wk-mediatek-filogic.ipk`ï¼šè”å‘ç§‘ Filogic ç³»åˆ—ï¼ˆå¦‚ å°ç±³ AX6000T/AX4200Tã€çº¢ç±³ AX6000/AX3000Tã€360T7 ç­‰åŒå¹³å°ï¼‰
- `ech-wk-ipq807x-generic.ipk`ï¼šé«˜é€š IPQ807x ç³»åˆ—ï¼ˆå¦‚ çº¢ç±³ AX6/å°ç±³ AX3600ã€ç«æ–—äº‘ 3.0ã€ç½‘ä»¶éƒ¨åˆ† RAX å‹å·ï¼‰
- `ech-wk-bcm27xx-bcm2711.ipk`ï¼šæ ‘è“æ´¾ 4B/400/CM4 ç­‰ BCM2711 å¹³å°
- `ech-wk-ramips-mt7621.ipk`ï¼šMT7621 ä¸»æµè·¯ç”±ï¼ˆå¦‚ æ–è®¯ K2Pã€Newifi D2ã€GL.iNet MT1300/MT3000 ç­‰ï¼‰

> å¦‚æœéœ€è¦æ–°å¢å…¶å®ƒå¹³å°ï¼Œè¯·åœ¨ Issue ä¸­ç•™è¨€å‹å·ä¸æ¶æ„ï¼Œæˆ‘ä»¬ä¼šå†è¡¥å……æ–°çš„æ„å»ºç›®æ ‡ã€‚

## å‘½ä»¤è¡Œä½¿ç”¨

å¦‚æœæ‚¨ä¸ä½¿ç”¨ LuCI ç•Œé¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œï¼š

```bash
ech-wk -server your-worker.workers.dev:443 -listen 127.0.0.1:30000
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|--------|
| `-server` | æœåŠ¡ç«¯åœ°å€ï¼ˆå¿…éœ€ï¼‰ | - |
| `-listen` | ç›‘å¬åœ°å€ | `127.0.0.1:30000` |
| `-token` | èº«ä»½éªŒè¯ä»¤ç‰Œ | - |
| `-ip` | æŒ‡å®šæœåŠ¡ç«¯ IPï¼ˆç»•è¿‡ DNSï¼‰ | - |
| `-doh` | DoH æœåŠ¡å™¨ | `dns.alidns.com/dns-query` |
| `-ech` | ECH æŸ¥è¯¢åŸŸå | `cloudflare-ech.com` |

**å®Œæ•´ç¤ºä¾‹ï¼š**

```bash
ech-wk \
  -server your-worker.workers.dev:443 \
  -listen 0.0.0.0:30000 \
  -token your-token \
  -ip saas.sin.fan \
  -doh dns.alidns.com/dns-query \
  -ech cloudflare-ech.com
```

## é…ç½®ä»£ç†å®¢æˆ·ç«¯

å®‰è£…å®Œæˆåï¼Œé…ç½®æ‚¨çš„è®¾å¤‡ä½¿ç”¨ SOCKS5 ä»£ç†ï¼š

- **ä»£ç†åœ°å€**ï¼š`è·¯ç”±å™¨IP` æˆ– `127.0.0.1`
- **ç«¯å£**ï¼š`30000`ï¼ˆæˆ–æ‚¨è‡ªå®šä¹‰çš„ç«¯å£ï¼‰
- **ä»£ç†ç±»å‹**ï¼šSOCKS5

### é…åˆ PassWall ä½¿ç”¨

1. è¿›å…¥ PassWall â†’ èŠ‚ç‚¹åˆ—è¡¨
2. æ·»åŠ  SOCKS5 èŠ‚ç‚¹ï¼š
   - åœ°å€ï¼š`127.0.0.1`
   - ç«¯å£ï¼š`30000`
3. åœ¨ä¸»é…ç½®ä¸­é€‰æ‹©è¯¥èŠ‚ç‚¹

### é…åˆ OpenClash ä½¿ç”¨

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```yaml
proxies:
  - name: "ECH-Workers"
    type: socks5
    server: 127.0.0.1
    port: 30000
```

## æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
/etc/init.d/ech-wk start

# åœæ­¢æœåŠ¡
/etc/init.d/ech-wk stop

# é‡å¯æœåŠ¡
/etc/init.d/ech-wk restart

# æŸ¥çœ‹çŠ¶æ€
/etc/init.d/ech-wk status

# å¯ç”¨å¼€æœºè‡ªå¯
/etc/init.d/ech-wk enable

# ç¦ç”¨å¼€æœºè‡ªå¯
/etc/init.d/ech-wk disable

# æŸ¥çœ‹æ—¥å¿—
cat /tmp/ech-wk.log
logread | grep ech-wk
```

## å¸¸è§é—®é¢˜

### Q: å®‰è£…ååœ¨æœåŠ¡èœå•æ‰¾ä¸åˆ°ï¼Ÿ

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ååˆ·æ–°é¡µé¢ï¼š
```bash
rm -rf /tmp/luci-*
```

### Q: å¦‚ä½•å®Œå…¨å¸è½½ï¼Ÿ

```bash
opkg remove ech-wk
rm -rf /tmp/luci-*
```

### Q: æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Ÿ

- ä½¿ç”¨ã€Œé«˜çº§é€‰é¡¹ã€ä¸­çš„ã€Œä¼˜é€‰IP/åŸŸåã€å‡å°‘ DNS æŸ¥è¯¢
- å¦‚æœç›‘å¬åœ°å€è®¾ä¸º `0.0.0.0`ï¼Œè®°å¾—é…ç½®é˜²ç«å¢™è§„åˆ™

### Q: å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Ÿ

```bash
# å¸è½½æ—§ç‰ˆæœ¬
opkg remove ech-wk

# å®‰è£…æ–°ç‰ˆæœ¬
opkg install /tmp/ech-wk_x.x.x-r1_x86_64.ipk

# æ¸…é™¤ç¼“å­˜
rm -rf /tmp/luci-*
```

## è‡´è°¢

- åŸå§‹é¡¹ç›®æ¥æºï¼š[CF_NAT](https://t.me/CF_NAT)
- ä¸­å›½IPåˆ—è¡¨ï¼š[mayaxcn/china-ip-list](https://github.com/mayaxcn/china-ip-list)

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
